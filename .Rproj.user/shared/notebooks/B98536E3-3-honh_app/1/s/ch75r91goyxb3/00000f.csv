"0","library(shiny)"
"0","library(reticulate)"
"0",""
"0","# Carregar o modelo treinado no Python"
"0","py_run_string(""from joblib import load"") # Importamos o modelo gerado pelo python"
"0","rf_tuned <- py$load(""rf_tuned.joblib"") # Utilizamos o reticulate para carregar o modelo"
"0",""
"0","# Mapeamentos para conversão no servidor"
"0","## Precisamos mapear de número de volta para label para ser apresentado na UI"
"0","hair_color_map <- 1:11"
"0","names(hair_color_map) <- c(""Castanho-aloirado"", ""Castanho-aloirado, Cinza"", ""Castanho-aloirado, Branco"", "
"0","                           ""Preto"", ""Loiro"",""Loiro"", ""Marrom"", ""Marrom, Cinza"", ""Cinza"", ""Nenhum"", ""Branco"")"
"0",""
"0","skin_color_map <- 1:30"
"0","names(skin_color_map) <- c(""Azul"", ""Azul, Cinza"", ""Marrom"", ""Marrom Sardento"", ""Marrom, Branco"","
"0","                           ""Escuro"", ""Claro"", ""Claro, Verde, Amarelo"", ""Dourado"", ""Verde"","
"0","                           ""Verde-Tan, Marrom"", ""Verde, Cinza"", ""Cinza"", ""Cinza, Azul"","
"0","                           ""Cinza, Verde, Amarelo"", ""Cinza, Vermelho"", ""Claro"", ""Metálico"","
"0","                           ""Verde Mosqueado"", ""Laranja"", ""Pálido"", ""Vermelho"", ""Vermelho, Azul, Branco"","
"0","                           ""Prateado, Vermelho"", ""Bronzeado"", ""Desconhecido"", ""Branco"", ""Branco, Azul"","
"0","                           ""Branco, Vermelho"", ""Amarelo"")"
"0",""
"0","# Interface do Usuário"
"0","ui <- fluidPage( # A UI é toda a parte de interface com o usuário, inclusive layout"
"0","  titlePanel(h1(strong(""Human Or Not Human""), align = ""center"")),"
"0","  hr(), # linha horizontal"
"0","  sidebarLayout( # Esses slidebarLayout e Panel são layouts prontos para trazer objetos para a UI"
"0","    sidebarPanel("
"0","      selectInput(""hair_color"", ""Cor do Cabelo"", choices = names(hair_color_map)),"
"0","      selectInput(""skin_color"", ""Cor da Pele"", choices = names(skin_color_map)),"
"0","      sliderInput(""imc"", ""IMC"", min = 10, max = 40, value = 20),"
"0","      actionButton(""goButton"", ""Classificar"")"
"0","    ),"
"0","    mainPanel("
"0","      div( # Utilizamos o div para conseguir aplicar o style no texto"
"0","        textOutput(""prediction""), "
"0","        style = ""font-style: italic; font-size: 24px; text-align: center;"""
"0","        ),"
"0","      div("
"0","        imageOutput(""image_output""), "
"0","        style = ""text-align: center;"""
"0","        )"
"0","    )"
"0","  )"
"0",")"
"0","# Finalizado toda a parte visual para o servidor, onde é gerenciado a lógica de back-end"
"0",""
"0","# Servidor"
"0","server <- function(input, output) { # A função é básica, definimos as opções de input na UI e aqui trabalhamos o output"
"0","output$image_output <- renderImage({"
"0","    if (input$goButton == 0) {"
"0","      # Mostra a imagem inicial antes de qualquer classificação"
"0","      list(src = ""www/human_or_not_human.png"", height = ""400"", width = ""400"")"
"0","    } else {"
"0","      # Dependendo da previsão, mostrar a imagem correspondente"
"0","      prediction <- eventReactive(input$goButton, {"
"0","        user_data <- data.frame("
"0","          hair_color = as.numeric(hair_color_map[input$hair_color]),"
"0","          skin_color = as.numeric(skin_color_map[input$skin_color]),"
"0","          imc = input$imc"
"0","        )"
"0","        "
"0","        names(user_data) <- c(""hair_color"", ""skin_color"", ""imc"")"
"0","        cat(""Debug: Dados de entrada preparados\n"", file = stderr()) "
"0","        # Adicionamos algumsa funções debug, para mostrar o que está sendo feito"
"0","        "
"0","        prediction <- rf_tuned$predict_proba(user_data)[,2]"
"0","        cat(""Debug: Previsão calculada\n"", file = stderr())"
"0","        "
"0","        # Dividimos em output da imagem e do texto"
"0","        # Output imagem"
"0","        if (prediction > 0.7) { # Consideramos humano aquelas probabilidades maior que 70%"
"0","          ""Humano"""
"0","        } else {"
"0","          ""Alienígena"""
"0","        }"
"0","      })()"
"0","      "
"0","      if (prediction == ""Humano"") {"
"0","        # Mostra a imagem de humano"
"0","        list(src = ""www/humano_img.png"", height = ""400"", width = ""400"")"
"0","      } else {"
"0","        # Mostra a imagem do alinígena"
"0","        list(src = ""www/alienigena_img.png"", height = ""400"", width = ""400"")"
"0","      }"
"0","    }"
"0","  }, deleteFile = FALSE)"
"0","  "
"0","  output$prediction <- renderText({"
"0","    if (input$goButton > 0) {  # Só mostrar a previsão após o botão ser pressionado"
"0","      eventReactive(input$goButton, {"
"0","        cat(""Debug: Classificação iniciada\n"", file = stderr())"
"0","        # Output texto"
"0","        if (rf_tuned$predict_proba(data.frame("
"0","          hair_color = as.numeric(hair_color_map[input$hair_color]),"
"0","          skin_color = as.numeric(skin_color_map[input$skin_color]),"
"0","          imc = input$imc"
"0","        ))[,2] > 0.7) {"
"0","          ""Humano"""
"0","        } else {"
"0","          ""Alienígena"""
"0","        }"
"0","      })()"
"0","    }"
"0","  })"
"0","}"
"0",""
"0","# Executa a aplicação"
"0","shinyApp(ui = ui, server = server)"
"2","
Listening on http://127.0.0.1:5188
"
"2","Debug: Dados de entrada preparados
"
"2","Debug: Previsão calculada
"
"2","Debug: Classificação iniciada
"
"2","Debug: Dados de entrada preparados
"
"2","Debug: Previsão calculada
"
"2","Debug: Classificação iniciada
"
"2","Debug: Dados de entrada preparados
"
"2","Debug: Previsão calculada
"
"2","Debug: Classificação iniciada
"
